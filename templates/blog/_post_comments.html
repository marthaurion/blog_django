{% if comment_list %}
    {% load mptt_tags %}
    <ul class="media-list" id="comment-list">
    {% recursetree comment_list %}
        {% if not node.is_child_node %}
            <li class="media" id="comment{{ node.pk }}">
        {% else %}
            <div class="media" id="comment{{ node.pk }}">
        {% endif %}
            <div class="media-left">
                <a href="{{ node.author.get_profile_url }}">
                    <img class="media-object" src="{{ node.author.get_image_url }}" alt="testing" height="50" width="50" />
                </a>
            </div>
            <div class="media-body">
                <h4 class="media-heading">
                    {% if node.author.website %}
                        <a href="{{ node.author.website }}">{{ node.author.username }}</a>
                    {% else %}
                        {{ node.author.username }}
                    {% endif %}
                </h4>
                <a href="{{ node.get_absolute_url }}"><small class="text-muted">{{ node.pub_date }}</small></a>
                <p>{{ node.html_text|safe }}</p>
                <p><a href="#comment{{ node.pk }}" onclick="replyForm(this, {{ node.pk }})">Reply</a></p>
            {% if not node.is_leaf_node and node.level < 2 %}
                {{ children }}
                </div>
            {% elif not node.is_leaf_node and node.level >= 2 %}
                </div>
                {{ children }}
            {% endif %}
        {% if not node.is_child_node %}
            </li>
        {% else %}
            </div>
        {% endif %}
    {% endrecursetree %}
    </ul>
{% else %}
    <h3>No comments found.</h3>
    <br>
{% endif %}

<div class="well" id="comment-form">
    <h4><strong>Leave a comment</strong></h4>
    <p id='cancel-reply' hidden><a href="#comment-form" onclick="cancelReply()">Cancel Reply to Comment</a></p>
    <form class="form-group" action="{{ post_comment_url }}" method="post">
        {% csrf_token %}
        {{ form.non_field_errors }}
        <p>
            {{ form.username.errors }}
            <label for="{{ form.username.id_for_label }}">Name:</label>
            {{ form.username }}
        </p>
        <p>
            {{ form.email.errors }}
            <label for="{{ form.email.id_for_label }}">Email:</label>
            {{ form.email }}
        </p>
        <p>
            {{ form.website.errors }}
            <label for="{{ form.website.id_for_label }}">Website:</label>
            {{ form.website }}
        </p>
        <p>
            {{ form.text.errors }}
            <label for="{{ form.text.id_for_label }}">Comment:</label>
            <p class="pull-right">
                <a href="javascript:void(insertBBCode('b'))" class="btn btn-primary btn-xs">b</a>
                <a href="javascript:void(insertBBCode('i'))" class="btn btn-primary btn-xs">i</a>
                <a href="javascript:void(insertBBCode('u'))" class="btn btn-primary btn-xs">u</a>
                <a href="javascript:void(insertBBCode('quote'))" class="btn btn-primary btn-xs">quote</a>
            </p>
            {{ form.text }}
        </p>
        {{ form.parent }}
        <p><div class="checkbox">
            <label><input type="checkbox" name="notify" {% if comment_notify %}checked{% endif %}/>Notify me with replies</label>
        </div></p>
        <input type="submit" class="btn btn-primary" value="Post Comment" />
    </form>
</div>